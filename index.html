import React, { useState, useEffect } from 'react';
import { Calendar, Users, Baby, Clock, MapPin, Plus, Lock, X, ChevronLeft, ChevronRight, Phone, Mail, Loader, AlertTriangle, WifiOff, Database } from 'lucide-react';

// --- Configuration Supabase (API REST) ---
const SUPABASE_URL = 'https://bnloivgpihtsxydjkgyc.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJubG9pdmdwaWh0c3h5ZGprZ3ljIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE0MDY4MjIsImV4cCI6MjA4Njk4MjgyMn0.U1p2xnYLprSO8-w-6mlG9BMO4_-A916XGmsKQ5WkdEg';

// Helper pour les appels API
const supabaseFetch = async (endpoint, options = {}) => {
    const headers = {
        'apikey': SUPABASE_KEY,
        'Authorization': `Bearer ${SUPABASE_KEY}`,
        'Content-Type': 'application/json',
        ...options.headers
    };

    const response = await fetch(`${SUPABASE_URL}/rest/v1/${endpoint}`, {
        ...options,
        headers
    });

    if (!response.ok) {
        const errorText = await response.text();
        throw new Error(`Erreur Supabase: ${response.status} ${errorText}`);
    }

    // On retourne le JSON sauf si le contenu est vide (ex: DELETE/POST sans retour)
    const text = await response.text();
    return text ? JSON.parse(text) : null;
};

// --- Composants ---

const Modal = ({ isOpen, onClose, title, children }) => {
    if (!isOpen) return null;
    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden animate-fade-in">
                <div className="bg-sky-600 p-4 flex justify-between items-center text-white">
                    <h3 className="text-xl font-bold">{title}</h3>
                    <button onClick={onClose} className="hover:bg-sky-700 p-1 rounded transition"><X size={20} /></button>
                </div>
                <div className="p-6 max-h-[80vh] overflow-y-auto">
                    {children}
                </div>
            </div>
        </div>
    );
};

const App = () => {
    // État de l'application
    const [events, setEvents] = useState([]);
    const [currentDate, setCurrentDate] = useState(new Date());
    const [selectedEventId, setSelectedEventId] = useState(null);
    const [loading, setLoading] = useState(true);
    const [dbError, setDbError] = useState(null);
    
    // États Modale / Admin
    const [isLoginModalOpen, setIsLoginModalOpen] = useState(false);
    const [isAdmin, setIsAdmin] = useState(false);
    const [passwordInput, setPasswordInput] = useState("");
    const [loginError, setLoginError] = useState("");

    // États Formulaires
    const [isAddEventOpen, setIsAddEventOpen] = useState(false);
    const [registrationForm, setRegistrationForm] = useState({ amName: "", contact: "", childCount: 1, childNames: "" });
    const [newEventForm, setNewEventForm] = useState({ title: "", date: "", startTime: "", endTime: "", location: "", description: "" });

    // --- Chargement des Données ---
    const fetchData = async () => {
        setLoading(true);
        try {
            // Requête : events + jointure registrations
            // Equivalent à .select('*, rpe_registrations(*)')
            const data = await supabaseFetch('rpe_events?select=*,rpe_registrations(*)&order=date.asc');

            // Formatage des données
            const formattedData = data.map(ev => ({
                ...ev,
                registrations: ev.rpe_registrations || []
            }));

            setEvents(formattedData);
            setDbError(null);
        } catch (error) {
            console.error("Erreur chargement:", error);
            setDbError({ message: "Impossible de charger le planning. Vérifiez votre connexion." });
        } finally {
            setLoading(false);
        }
    };

    // Charger les données au démarrage
    useEffect(() => {
        fetchData();
        // Note: Le temps réel (WebSocket) est désactivé dans cette version REST simplifiée
        // On peut ajouter un intervalle pour rafraîchir périodiquement si besoin
        // const interval = setInterval(fetchData, 30000); return () => clearInterval(interval);
    }, []);

    // Dériver l'événement sélectionné depuis la liste à jour
    const selectedEvent = events.find(e => e.id === selectedEventId);

    // --- Logique Calendrier ---
    const daysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
    const firstDayOfMonth = (date) => {
        let day = new Date(date.getFullYear(), date.getMonth(), 1).getDay();
        return day === 0 ? 6 : day - 1; 
    };

    const monthNames = ["Janvier", "Février", "Mars", "Avril", "Mai", "Juin", "Juillet", "Août", "Septembre", "Octobre", "Novembre", "Décembre"];

    const handlePrevMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
    const handleNextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));

    // --- Logique Admin ---
    const handleAdminLogin = (e) => {
        e.preventDefault();
        if (passwordInput === "CCMVRRPE") {
            setIsAdmin(true);
            setIsLoginModalOpen(false);
            setPasswordInput("");
            setLoginError("");
        } else {
            setLoginError("Code incorrect.");
        }
    };

    const handleLogout = () => {
        setIsAdmin(false);
        alert("Vous êtes déconnecté du mode RPE.");
    };

    // --- Logique Événements (API REST) ---
    const handleAddEvent = async (e) => {
        e.preventDefault();
        
        try {
            await supabaseFetch('rpe_events', {
                method: 'POST',
                headers: { 'Prefer': 'return=minimal' },
                body: JSON.stringify({
                    title: newEventForm.title,
                    date: newEventForm.date,
                    start_time: newEventForm.startTime,
                    end_time: newEventForm.endTime,
                    location: newEventForm.location,
                    description: newEventForm.description
                })
            });

            setIsAddEventOpen(false);
            setNewEventForm({ title: "", date: "", startTime: "", endTime: "", location: "", description: "" });
            fetchData(); // Rafraîchir
        } catch (error) {
            console.error("Erreur ajout:", error);
            alert("Erreur lors de la création de l'événement.");
        }
    };

    const handleRegister = async (e) => {
        e.preventDefault();
        if (!selectedEvent) return;

        try {
            await supabaseFetch('rpe_registrations', {
                method: 'POST',
                headers: { 'Prefer': 'return=minimal' },
                body: JSON.stringify({
                    event_id: selectedEvent.id,
                    am_name: registrationForm.amName,
                    contact: registrationForm.contact,
                    child_count: parseInt(registrationForm.childCount),
                    child_names: registrationForm.childNames
                })
            });

            setRegistrationForm({ amName: "", contact: "", childCount: 1, childNames: "" });
            alert("Inscription validée !");
            fetchData(); // Rafraîchir
        } catch (error) {
            console.error("Erreur inscription:", error);
            alert("Erreur lors de l'inscription.");
        }
    };

    const deleteEvent = async (id) => {
        if (confirm("Êtes-vous sûr de vouloir supprimer cette animation ?")) {
            try {
                await supabaseFetch(`rpe_events?id=eq.${id}`, {
                    method: 'DELETE'
                });
                
                setSelectedEventId(null);
                fetchData();
            } catch (error) {
                console.error("Erreur suppression:", error);
                alert("Impossible de supprimer l'événement.");
            }
        }
    };

    // --- Rendu du Calendrier ---
    const renderCalendarCells = () => {
        const totalDays = daysInMonth(currentDate);
        const startDay = firstDayOfMonth(currentDate);
        const cells = [];

        for (let i = 0; i < startDay; i++) {
            cells.push(<div key={`empty-${i}`} className="h-24 md:h-32 bg-slate-50 border border-slate-100"></div>);
        }

        for (let day = 1; day <= totalDays; day++) {
            const cellDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
            const offsetDate = new Date(cellDate.getTime() - (cellDate.getTimezoneOffset() * 60000));
            const strictDateKey = offsetDate.toISOString().split('T')[0];

            const dayEvents = events.filter(e => e.date === strictDateKey);

            cells.push(
                <div key={day} className="min-h-[6rem] md:min-h-[8rem] bg-white border border-slate-200 p-1 md:p-2 relative hover:bg-slate-50 transition">
                    <span className="font-bold text-slate-400 text-sm">{day}</span>
                    <div className="mt-1 flex flex-col gap-1 overflow-y-auto max-h-[5rem] md:max-h-[6rem]">
                        {dayEvents.map(ev => (
                            <button 
                                key={ev.id}
                                onClick={() => setSelectedEventId(ev.id)}
                                className="text-left text-xs bg-sky-100 text-sky-800 p-1 rounded border-l-4 border-sky-500 truncate shadow-sm hover:bg-sky-200 transition w-full"
                            >
                                <span className="font-bold">{ev.start_time}</span> <span className="opacity-90">{ev.title}</span>
                            </button>
                        ))}
                    </div>
                </div>
            );
        }
        return cells;
    };

    // --- Calculs Totaux ---
    const getTotalChildren = (ev) => (ev.registrations || []).reduce((acc, curr) => acc + (parseInt(curr.child_count) || 0), 0);
    const getTotalAM = (ev) => (ev.registrations || []).length;

    // --- Gestion des Erreurs et Chargement ---
    if (dbError) {
        return (
            <div className="min-h-screen flex items-center justify-center bg-red-50 p-4 font-sans">
                <div className="bg-white p-6 rounded-xl shadow-xl max-w-lg w-full border-l-4 border-red-500 animate-fade-in">
                    <div className="flex items-center gap-3 mb-4 text-red-600">
                        <AlertTriangle size={32} />
                        <h2 className="text-xl font-bold">Erreur de connexion</h2>
                    </div>
                    <p className="text-gray-700 mb-4">{dbError.message}</p>
                    <button onClick={fetchData} className="w-full bg-slate-800 text-white py-2 rounded font-bold hover:bg-slate-900 transition">
                        Réessayer
                    </button>
                </div>
            </div>
        );
    }

    if (loading && events.length === 0) {
        return (
            <div className="min-h-screen flex items-center justify-center bg-[#f0f9ff] text-sky-600">
                <div className="flex flex-col items-center gap-2 animate-pulse">
                    <Loader className="animate-spin" size={32} />
                    <span className="font-semibold">Chargement du planning...</span>
                </div>
            </div>
        );
    }

    return (
        <div className="min-h-screen pb-10 flex flex-col font-sans bg-[#f0f9ff]">
             <style>{`
                .hidden-trigger {
                    position: fixed;
                    bottom: 0;
                    right: 0;
                    width: 5px;
                    height: 5px;
                    background-color: transparent;
                    cursor: default;
                    z-index: 50;
                }
                .hidden-trigger:hover {
                    background-color: rgba(0,0,0,0.01); 
                }
                @keyframes fadeIn {
                    from { opacity: 0; transform: scale(0.95); }
                    to { opacity: 1; transform: scale(1); }
                }
                .animate-fade-in {
                    animation: fadeIn 0.2s ease-out forwards;
                }
            `}</style>

            {/* Header */}
            <header className="bg-white shadow-md border-b border-sky-100 sticky top-0 z-20">
                <div className="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
                    <div className="flex items-center gap-3">
                        <div className="bg-sky-600 p-2 rounded-lg text-white shadow-sm">
                            <Baby size={28} />
                        </div>
                        <div>
                            <h1 className="text-xl md:text-2xl font-bold text-slate-800 leading-none">Relais Petite Enfance</h1>
                            <p className="text-xs text-slate-500 font-medium mt-1">Communauté de Communes</p>
                        </div>
                    </div>
                    
                    <div className="flex items-center gap-2">
                        <span className="bg-green-100 text-green-800 px-2 py-1 rounded text-[10px] md:text-xs font-bold border border-green-200 flex items-center gap-1">
                            <Database size={10} /> EN LIGNE (SUPABASE)
                        </span>

                        {isAdmin && (
                            <div className="flex items-center gap-2">
                                <span className="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-xs font-bold border border-amber-200 shadow-sm">ADMIN</span>
                                <button onClick={handleLogout} className="text-slate-400 hover:text-red-500 text-xs underline transition">Quitter</button>
                            </div>
                        )}
                    </div>
                </div>
            </header>

            {/* Navigation Mois */}
            <div className="max-w-6xl mx-auto px-4 py-6 w-full flex-grow">
                <div className="flex justify-between items-center mb-6 bg-white p-3 rounded-xl shadow-sm border border-slate-100">
                    <button onClick={handlePrevMonth} className="p-2 hover:bg-slate-100 rounded-full text-slate-600 transition"><ChevronLeft size={24} /></button>
                    <h2 className="text-xl md:text-2xl font-bold text-slate-700 capitalize">
                        {monthNames[currentDate.getMonth()]} {currentDate.getFullYear()}
                    </h2>
                    <button onClick={handleNextMonth} className="p-2 hover:bg-slate-100 rounded-full text-slate-600 transition"><ChevronRight size={24} /></button>
                </div>

                {isAdmin && (
                    <div className="mb-4 text-right animate-fade-in">
                        <button 
                            onClick={() => setIsAddEventOpen(true)}
                            className="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg shadow-md flex items-center gap-2 ml-auto transition transform hover:scale-105"
                        >
                            <Plus size={18} /> Ajouter une animation
                        </button>
                    </div>
                )}

                {/* Grille Calendrier */}
                <div className="grid grid-cols-7 gap-px bg-slate-200 border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                    {['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'].map(day => (
                        <div key={day} className="bg-slate-50 py-3 text-center text-xs font-bold text-slate-500 uppercase tracking-wider">
                            {day}
                        </div>
                    ))}
                    {renderCalendarCells()}
                </div>
            </div>

            {/* Modale Détails Événement */}
            <Modal 
                isOpen={!!selectedEvent} 
                onClose={() => { setSelectedEventId(null); setRegistrationForm({ amName: "", contact: "", childCount: 1, childNames: "" }); }}
                title="Détails de l'animation"
            >
                {selectedEvent && (
                    <div className="space-y-6">
                        <div>
                            <h2 className="text-2xl font-bold text-sky-800 mb-1">{selectedEvent.title}</h2>
                            <div className="flex flex-wrap gap-4 text-sm text-slate-600 mt-3">
                                <div className="flex items-center gap-1 bg-sky-50 px-2 py-1 rounded text-sky-700 font-medium"><Clock size={16} /> {selectedEvent.start_time} - {selectedEvent.end_time}</div>
                                <div className="flex items-center gap-1 bg-sky-50 px-2 py-1 rounded text-sky-700 font-medium"><MapPin size={16} /> {selectedEvent.location}</div>
                            </div>
                            <p className="mt-4 text-slate-700 bg-slate-50 p-4 rounded-lg border border-slate-100 text-sm leading-relaxed">
                                {selectedEvent.description}
                            </p>
                        </div>

                        <div className="border-t border-slate-200 pt-4">
                            <h4 className="font-bold text-slate-800 mb-4 flex items-center gap-2 text-lg">
                                <Users size={20} className="text-sky-600" /> Inscriptions
                            </h4>
                            
                            {/* VUE ADMIN : Liste détaillée */}
                            {isAdmin ? (
                                <div className="space-y-3 animate-fade-in">
                                    {(!selectedEvent.registrations || selectedEvent.registrations.length === 0) ? (
                                        <p className="text-sm text-slate-500 italic bg-slate-50 p-4 rounded text-center">Aucune inscription pour le moment.</p>
                                    ) : (
                                        <div className="space-y-2 max-h-60 overflow-y-auto pr-1">
                                            {selectedEvent.registrations.map((reg, idx) => (
                                                <div key={idx} className="bg-white border border-slate-200 p-3 rounded shadow-sm text-sm hover:border-sky-200 transition">
                                                    <div className="flex justify-between font-bold text-slate-700">
                                                        <span>{reg.am_name}</span>
                                                        <span className="text-sky-600 bg-sky-50 px-2 rounded-full text-xs flex items-center">{reg.child_count} enfant(s)</span>
                                                    </div>
                                                    <div className="text-slate-500 flex items-center gap-1 mt-1 text-xs">
                                                        <Phone size={12}/> / <Mail size={12}/> : <span className="font-mono">{reg.contact}</span>
                                                    </div>
                                                    <div className="mt-2 text-slate-600 text-xs border-t border-slate-100 pt-1">
                                                        <span className="font-semibold text-slate-400">Enfants:</span> {reg.child_names || "Non précisé"}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                    <div className="mt-4 pt-3 border-t-2 border-slate-100 flex justify-between items-center bg-amber-50 p-3 rounded-lg">
                                        <span className="font-bold text-amber-800 text-sm">Total AM: {getTotalAM(selectedEvent)}</span>
                                        <span className="font-bold text-amber-800 text-sm">Total Enfants: {getTotalChildren(selectedEvent)}</span>
                                    </div>
                                    <button 
                                        onClick={() => deleteEvent(selectedEvent.id)}
                                        className="w-full mt-4 bg-red-50 text-red-600 border border-red-100 py-2 rounded-lg hover:bg-red-100 text-sm font-semibold transition"
                                    >
                                        Supprimer cet événement
                                    </button>
                                </div>
                            ) : (
                                // VUE PUBLIQUE : Formulaire + Totaux anonymes
                                <div className="animate-fade-in">
                                    <div className="flex justify-between items-center mb-6 bg-sky-50 p-4 rounded-xl border border-sky-100 shadow-sm">
                                        <div className="text-center w-1/2">
                                            <span className="block text-3xl font-bold text-sky-700">{getTotalAM(selectedEvent)}</span>
                                            <span className="text-[10px] md:text-xs text-sky-600 uppercase font-bold tracking-wide">Assistantes Mat.</span>
                                        </div>
                                        <div className="h-10 w-px bg-sky-200"></div>
                                        <div className="text-center w-1/2">
                                            <span className="block text-3xl font-bold text-sky-700">{getTotalChildren(selectedEvent)}</span>
                                            <span className="text-[10px] md:text-xs text-sky-600 uppercase font-bold tracking-wide">Enfants Prévus</span>
                                        </div>
                                    </div>

                                    <h4 className="font-bold text-slate-700 mb-3 text-sm uppercase tracking-wide border-b pb-2">Je m'inscris</h4>
                                    <form onSubmit={handleRegister} className="space-y-3">
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 mb-1">Nom Prénom (AM)</label>
                                            <input 
                                                required
                                                type="text" 
                                                className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-sky-500 outline-none transition"
                                                value={registrationForm.amName}
                                                onChange={e => setRegistrationForm({...registrationForm, amName: e.target.value})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-semibold text-slate-500 mb-1">Contact (Tél ou Mail)</label>
                                            <input 
                                                required
                                                type="text" 
                                                className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-sky-500 outline-none transition"
                                                value={registrationForm.contact}
                                                onChange={e => setRegistrationForm({...registrationForm, contact: e.target.value})}
                                            />
                                        </div>
                                        <div className="grid grid-cols-3 gap-3">
                                            <div className="col-span-1">
                                                <label className="block text-xs font-semibold text-slate-500 mb-1">Nbr Enfants</label>
                                                <input 
                                                    required
                                                    type="number" 
                                                    min="1" 
                                                    max="10"
                                                    className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-sky-500 outline-none transition"
                                                    value={registrationForm.childCount}
                                                    onChange={e => setRegistrationForm({...registrationForm, childCount: e.target.value})}
                                                />
                                            </div>
                                            <div className="col-span-2">
                                                <label className="block text-xs font-semibold text-slate-500 mb-1">Prénoms des enfants</label>
                                                <input 
                                                    type="text" 
                                                    placeholder="Ex: Léo, Mia..."
                                                    className="w-full border border-slate-300 rounded-lg p-2.5 text-sm focus:ring-2 focus:ring-sky-500 outline-none transition"
                                                    value={registrationForm.childNames}
                                                    onChange={e => setRegistrationForm({...registrationForm, childNames: e.target.value})}
                                                />
                                            </div>
                                        </div>
                                        <button type="submit" className="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 rounded-lg shadow-md mt-4 transition transform hover:scale-[1.02]">
                                            Valider mon inscription
                                        </button>
                                    </form>
                                </div>
                            )}
                        </div>
                    </div>
                )}
            </Modal>

            {/* Modale Login Admin */}
            <Modal 
                isOpen={isLoginModalOpen} 
                onClose={() => setIsLoginModalOpen(false)}
                title="Accès Administration RPE"
            >
                <form onSubmit={handleAdminLogin} className="space-y-4">
                    <div className="bg-sky-50 p-3 rounded text-sky-800 text-sm flex gap-2 items-start">
                        <Lock size={16} className="mt-0.5 flex-shrink-0" />
                        <p>Zone réservée aux animateurs RPE. Veuillez saisir le code d'accès.</p>
                    </div>
                    <div>
                        <input 
                            type="password" 
                            placeholder="Code d'accès"
                            className="w-full border border-slate-300 rounded-lg p-3 focus:ring-2 focus:ring-sky-500 outline-none transition"
                            value={passwordInput}
                            onChange={e => setPasswordInput(e.target.value)}
                            autoFocus
                        />
                        {loginError && <p className="text-red-500 text-xs mt-2 font-bold flex items-center gap-1"><X size={12}/> {loginError}</p>}
                    </div>
                    <button type="submit" className="w-full bg-slate-800 text-white font-bold py-3 rounded-lg hover:bg-slate-900 transition shadow-lg">
                        Connexion
                    </button>
                </form>
            </Modal>

            {/* Modale Ajout Événement (Admin seulement) */}
            <Modal 
                isOpen={isAddEventOpen} 
                onClose={() => setIsAddEventOpen(false)}
                title="Ajouter une animation"
            >
                <form onSubmit={handleAddEvent} className="space-y-3">
                    <div>
                        <label className="block text-xs font-semibold text-slate-500 mb-1">Titre de l'animation</label>
                        <input required type="text" className="w-full border p-2 rounded focus:ring-2 focus:ring-emerald-500 outline-none" value={newEventForm.title} onChange={e => setNewEventForm({...newEventForm, title: e.target.value})} />
                    </div>
                    <div>
                        <label className="block text-xs font-semibold text-slate-500 mb-1">Date</label>
                        <input required type="date" className="w-full border p-2 rounded focus:ring-2 focus:ring-emerald-500 outline-none" value={newEventForm.date} onChange={e => setNewEventForm({...newEventForm, date: e.target.value})} />
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                        <div>
                            <label className="block text-xs font-semibold text-slate-500 mb-1">Heure Début</label>
                            <input required type="time" className="w-full border p-2 rounded focus:ring-2 focus:ring-emerald-500 outline-none" value={newEventForm.startTime} onChange={e => setNewEventForm({...newEventForm, startTime: e.target.value})} />
                        </div>
                        <div>
                            <label className="block text-xs font-semibold text-slate-500 mb-1">Heure Fin</label>
                            <input required type="time" className="w-full border p-2 rounded focus:ring-2 focus:ring-emerald-500 outline-none" value={newEventForm.endTime} onChange={e => setNewEventForm({...newEventForm, endTime: e.target.value})} />
                        </div>
                    </div>
                    <div>
                        <label className="block text-xs font-semibold text-slate-500 mb-1">Lieu</label>
                        <input required type="text" className="w-full border p-2 rounded focus:ring-2 focus:ring-emerald-500 outline-none" value={newEventForm.location} onChange={e => setNewEventForm({...newEventForm, location: e.target.value})} />
                    </div>
                    <div>
                        <label className="block text-xs font-semibold text-slate-500 mb-1">Description</label>
                        <textarea className="w-full border p-2 rounded focus:ring-2 focus:ring-emerald-500 outline-none" rows="3" value={newEventForm.description} onChange={e => setNewEventForm({...newEventForm, description: e.target.value})}></textarea>
                    </div>
                    <button type="submit" className="w-full bg-emerald-600 text-white font-bold py-3 rounded shadow hover:bg-emerald-700 transition mt-2">
                        Ajouter au planning
                    </button>
                </form>
            </Modal>

            {/* LE BOUTON SECRET : 5x5 pixels en bas à droite */}
            <div 
                className="hidden-trigger" 
                onClick={() => setIsLoginModalOpen(true)}
                title="Zone Admin" 
            ></div>
        </div>
    );
};

export default App;
